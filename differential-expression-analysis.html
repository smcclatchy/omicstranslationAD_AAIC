<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Omics Translation in AD: Differential expression analysis</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="manifest" href="site.webmanifest"><link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav "><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="-logo" alt="" src="assets/images/-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/differential-expression-analysis.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav " aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="" src="assets/images/-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Omics Translation in AD
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Omics Translation in AD
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Omics Translation in AD
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 29%" class="percentage">
    29%
  </div>
  <div class="progress ">
    <div class="progress-bar " role="progressbar" style="width: 29%" aria-valuenow="29" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/differential-expression-analysis.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="introduction.html">1. Introduction to Omics Translation in AD</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="exploring-data-in-synapse.html">2. Synapse and AD Knowledge Portal</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        3. Differential expression analysis
        </span>
      
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="mouse-human-alignment.html">4. Mouse-human alignment of transcriptomic signatures</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width resources"><a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="exploring-data-in-synapse.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="mouse-human-alignment.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="exploring-data-in-synapse.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Synapse and AD
        </a>
        <a class="chapter-link float-end" href="mouse-human-alignment.html" rel="next">
          Next: Mouse-human...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Differential expression analysis</h1>
        <p>Last updated on 2024-07-30 |

        <a href="https://github.com/carpentries/workbench-template-md/edit/main/episodes/differential-expression-analysis.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>What transcriptomic changes do we observe in mouse models carrying
AD-related mutations?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Read in a count matrix and metadata.</li>
<li>Understand the data from AD mouse models</li>
<li>Format the data for differential analysis</li>
<li>Perform differential analysis using DESeq2.</li>
<li>Pathway enrichment of differentially expressed genes</li>
<li>Save data for next lessons</li>
</ul></div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="differential-expression-analysis">Differential Expression Analysis<a class="anchor" aria-label="anchor" href="#differential-expression-analysis"></a></h1>
<p><strong>Reading Gene Expression Count matrix from Previous
Lesson</strong></p>
<p>In this lesson, we will use the raw counts matrix and metadata
downloaded in the previous lesson and will perform differential
expression analysis.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu">read.delim</span><span class="op">(</span><span class="st">"data/htseqcounts_5XFAD.txt"</span>, check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre>
</div>
<p><strong>Reading Sample Metadata from Previous Lesson</strong></p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covars</span> <span class="op">&lt;-</span> <span class="fu">readRDS</span><span class="op">(</span><span class="st">"data/covars_5XFAD.rds"</span><span class="op">)</span></span></code></pre>
</div>
<p>Let’s explore the data:</p>
<p>Let’s look at the top of the metadata.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">covars</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>        individualID specimenID    sex         genotype timepoint
32043rh        32043    32043rh female    5XFAD_carrier     12 mo
32044rh        32044    32044rh   male 5XFAD_noncarrier     12 mo
32046rh        32046    32046rh   male 5XFAD_noncarrier     12 mo
32047rh        32047    32047rh   male 5XFAD_noncarrier     12 mo
32049rh        32049    32049rh female 5XFAD_noncarrier     12 mo
32057rh        32057    32057rh female 5XFAD_noncarrier     12 mo</code></pre>
</div>
<p>identify distinct groups using sample metadata</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">distinct</span><span class="op">(</span><span class="va">covars</span>, <span class="va">sex</span>, <span class="va">genotype</span>, <span class="va">timepoint</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>           sex         genotype timepoint
32043rh female    5XFAD_carrier     12 mo
32044rh   male 5XFAD_noncarrier     12 mo
32049rh female 5XFAD_noncarrier     12 mo
46105rh female 5XFAD_noncarrier      6 mo
46108rh   male 5XFAD_noncarrier      6 mo
46131rh female 5XFAD_noncarrier      4 mo
46877rh   male 5XFAD_noncarrier      4 mo
46887rh female    5XFAD_carrier      4 mo
32053rh   male    5XFAD_carrier     12 mo
46111rh female    5XFAD_carrier      6 mo
46865rh   male    5XFAD_carrier      6 mo
46866rh   male    5XFAD_carrier      4 mo</code></pre>
</div>
<p>How many mice were used to produce this data?</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covars</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">sex</span>,<span class="va">genotype</span>,<span class="va">timepoint</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">count</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 12 × 4
# Groups:   sex, genotype, timepoint [12]
   sex    genotype         timepoint     n
   &lt;chr&gt;  &lt;chr&gt;            &lt;chr&gt;     &lt;int&gt;
 1 female 5XFAD_carrier    12 mo         6
 2 female 5XFAD_carrier    4 mo          6
 3 female 5XFAD_carrier    6 mo          6
 4 female 5XFAD_noncarrier 12 mo         6
 5 female 5XFAD_noncarrier 4 mo          6
 6 female 5XFAD_noncarrier 6 mo          6
 7 male   5XFAD_carrier    12 mo         6
 8 male   5XFAD_carrier    4 mo          6
 9 male   5XFAD_carrier    6 mo          6
10 male   5XFAD_noncarrier 12 mo         6
11 male   5XFAD_noncarrier 4 mo          6
12 male   5XFAD_noncarrier 6 mo          6</code></pre>
</div>
<p>How many rows and columns are there in counts?</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dim</span><span class="op">(</span><span class="va">counts</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 55489    73</code></pre>
</div>
<p>In the counts matrix, genes are in rows and samples are in columns.
Let’s look at the first few rows.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">counts</span>,n<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>             gene_id 32043rh 32044rh 32046rh 32047rh 32048rh 32049rh 32050rh
1    ENSG00000080815   22554       0       0       0   16700       0       0
2    ENSG00000142192  344489       4       0       1  260935       6       8
3 ENSMUSG00000000001    5061    3483    3941    3088    2756    3067    2711
4 ENSMUSG00000000003       0       0       0       0       0       0       0
5 ENSMUSG00000000028     208     162     138     127      95     154     165
  32052rh 32053rh 32057rh 32059rh 32061rh 32062rh 32065rh 32067rh 32068rh
1   19748   14023       0   17062       0   15986      10       0   18584
2  337456  206851       1  264748       0  252248     172       4  300398
3    3334    3841    4068    3306    4076    3732    3940    4238    3257
4       0       0       0       0       0       0       0       0       0
5     124     103     164     116     108     134     204     239     148
  32070rh 32073rh 32074rh 32075rh 32078rh 32081rh 32088rh 32640rh 46105rh
1       1       0       0   22783   17029   16626   15573   12721       4
2       4       2       9  342655  280968  258597  243373  188818      19
3    3351    3449    4654    4844    3132    3334    3639    3355    4191
4       0       0       0       0       0       0       0       0       0
5     159     167     157     211     162     149     160     103     158
  46106rh 46107rh 46108rh 46109rh 46110rh 46111rh 46112rh 46113rh 46115rh
1       0       0       0       0       0   17931       0   19087       0
2       0       0       1       5       1  293409       8  273704       1
3    3058    4265    3248    3638    3747    3971    3192    3805    3753
4       0       0       0       0       0       0       0       0       0
5     167     199     113     168     175     203     158     108     110
  46121rh 46131rh 46132rh 46134rh 46138rh 46141rh 46142rh 46862rh 46863rh
1       0       0   12703   18833       0   18702   17666       0   14834
2       0       1  187975  285048       0  284499  250600       0  218494
3    4134    3059    3116    3853    3682    2844    3466    3442    3300
4       0       0       0       0       0       0       0       0       0
5     179     137     145     183     171     138      88     154     157
  46865rh 46866rh 46867rh 46868rh 46871rh 46872rh 46873rh 46874rh 46875rh
1   10546   10830   10316   10638   15248       0       0   11608   11561
2  169516  152769  151732  190150  229063       6       1  165941  171303
3    3242    3872    3656    3739    3473    3154    5510    3657    4121
4       0       0       0       0       0       0       0       0       0
5     131     152     152     155     140      80     240     148     112
  46876rh 46877rh 46878rh 46879rh 46881rh 46882rh 46883rh 46884rh 46885rh
1       0       0   12683   15613       0   14084   20753       0       0
2       0       2  183058  216122       0  199448  306081       0       5
3    3422    3829    3996    4324    2592    2606    4600    2913    3614
4       0       0       0       0       0       0       0       0       0
5     147     166     169     215     115     101     174     127     151
  46886rh 46887rh 46888rh 46889rh 46890rh 46891rh 46892rh 46893rh 46895rh
1   16639   16072       0   16680   13367       0   25119      92       0
2  242543  258061       0  235530  196721       0  371037    1116       0
3    3294    3719    3899    4173    4008    3037    5967    3459    4262
4       0       0       0       0       0       0       0       0       0
5     139     128     210     127     156     116     260     161     189
  46896rh 46897rh
1   15934       0
2  235343       6
3    3923    3486
4       0       0
5     179     117</code></pre>
</div>
<p>As you can see, the gene ids are ENSEMBL IDs. There is some risk that
these may not be unique. Let’s check whether any of the gene symbols are
duplicated. We will sum the number of duplicated gene symbols.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sum</span><span class="op">(</span><span class="fu">duplicated</span><span class="op">(</span><span class="fu">rownames</span><span class="op">(</span><span class="va">counts</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0</code></pre>
</div>
<p>The sum equals zero, so there are no duplicated gene symbols, which
is good. Similarly, samples should be unique. Once again, let’s verify
this:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sum</span><span class="op">(</span><span class="fu">duplicated</span><span class="op">(</span><span class="fu">colnames</span><span class="op">(</span><span class="va">counts</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0</code></pre>
</div>
<p><strong>Formatting the count matrix</strong></p>
<p>Now, as we see that gene_id is in first column of count matrix, but
we will need only count data in matrix, so we will change the gene_id
column to rownames. Converting the gene_id as rownames of count
matrix</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="va">counts</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">column_to_rownames</span><span class="op">(</span><span class="va">.</span>,var<span class="op">=</span><span class="st">"gene_id"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">as.data.frame</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>let’s confirm if change is done correctly</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">counts</span>, n<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>                   32043rh 32044rh 32046rh 32047rh 32048rh 32049rh 32050rh
ENSG00000080815      22554       0       0       0   16700       0       0
ENSG00000142192     344489       4       0       1  260935       6       8
ENSMUSG00000000001    5061    3483    3941    3088    2756    3067    2711
ENSMUSG00000000003       0       0       0       0       0       0       0
ENSMUSG00000000028     208     162     138     127      95     154     165
                   32052rh 32053rh 32057rh 32059rh 32061rh 32062rh 32065rh
ENSG00000080815      19748   14023       0   17062       0   15986      10
ENSG00000142192     337456  206851       1  264748       0  252248     172
ENSMUSG00000000001    3334    3841    4068    3306    4076    3732    3940
ENSMUSG00000000003       0       0       0       0       0       0       0
ENSMUSG00000000028     124     103     164     116     108     134     204
                   32067rh 32068rh 32070rh 32073rh 32074rh 32075rh 32078rh
ENSG00000080815          0   18584       1       0       0   22783   17029
ENSG00000142192          4  300398       4       2       9  342655  280968
ENSMUSG00000000001    4238    3257    3351    3449    4654    4844    3132
ENSMUSG00000000003       0       0       0       0       0       0       0
ENSMUSG00000000028     239     148     159     167     157     211     162
                   32081rh 32088rh 32640rh 46105rh 46106rh 46107rh 46108rh
ENSG00000080815      16626   15573   12721       4       0       0       0
ENSG00000142192     258597  243373  188818      19       0       0       1
ENSMUSG00000000001    3334    3639    3355    4191    3058    4265    3248
ENSMUSG00000000003       0       0       0       0       0       0       0
ENSMUSG00000000028     149     160     103     158     167     199     113
                   46109rh 46110rh 46111rh 46112rh 46113rh 46115rh 46121rh
ENSG00000080815          0       0   17931       0   19087       0       0
ENSG00000142192          5       1  293409       8  273704       1       0
ENSMUSG00000000001    3638    3747    3971    3192    3805    3753    4134
ENSMUSG00000000003       0       0       0       0       0       0       0
ENSMUSG00000000028     168     175     203     158     108     110     179
                   46131rh 46132rh 46134rh 46138rh 46141rh 46142rh 46862rh
ENSG00000080815          0   12703   18833       0   18702   17666       0
ENSG00000142192          1  187975  285048       0  284499  250600       0
ENSMUSG00000000001    3059    3116    3853    3682    2844    3466    3442
ENSMUSG00000000003       0       0       0       0       0       0       0
ENSMUSG00000000028     137     145     183     171     138      88     154
                   46863rh 46865rh 46866rh 46867rh 46868rh 46871rh 46872rh
ENSG00000080815      14834   10546   10830   10316   10638   15248       0
ENSG00000142192     218494  169516  152769  151732  190150  229063       6
ENSMUSG00000000001    3300    3242    3872    3656    3739    3473    3154
ENSMUSG00000000003       0       0       0       0       0       0       0
ENSMUSG00000000028     157     131     152     152     155     140      80
                   46873rh 46874rh 46875rh 46876rh 46877rh 46878rh 46879rh
ENSG00000080815          0   11608   11561       0       0   12683   15613
ENSG00000142192          1  165941  171303       0       2  183058  216122
ENSMUSG00000000001    5510    3657    4121    3422    3829    3996    4324
ENSMUSG00000000003       0       0       0       0       0       0       0
ENSMUSG00000000028     240     148     112     147     166     169     215
                   46881rh 46882rh 46883rh 46884rh 46885rh 46886rh 46887rh
ENSG00000080815          0   14084   20753       0       0   16639   16072
ENSG00000142192          0  199448  306081       0       5  242543  258061
ENSMUSG00000000001    2592    2606    4600    2913    3614    3294    3719
ENSMUSG00000000003       0       0       0       0       0       0       0
ENSMUSG00000000028     115     101     174     127     151     139     128
                   46888rh 46889rh 46890rh 46891rh 46892rh 46893rh 46895rh
ENSG00000080815          0   16680   13367       0   25119      92       0
ENSG00000142192          0  235530  196721       0  371037    1116       0
ENSMUSG00000000001    3899    4173    4008    3037    5967    3459    4262
ENSMUSG00000000003       0       0       0       0       0       0       0
ENSMUSG00000000028     210     127     156     116     260     161     189
                   46896rh 46897rh
ENSG00000080815      15934       0
ENSG00000142192     235343       6
ENSMUSG00000000001    3923    3486
ENSMUSG00000000003       0       0
ENSMUSG00000000028     179     117</code></pre>
</div>
<p>As you can see from count table there are some genes that start with
“ENSG” and others start with “ENSMUSG”. “ENSG” referes to human gene
ENSEMBL id and “ENSMUSG” refer to mouse ENSEMBL id. Let’s check how many
gene_ids are NOT from the mouse genome by searching for the string “MUS”
(as in Mus musculus) in the rownames of count matrix</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">str_detect</span><span class="op">(</span><span class="fu">rownames</span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="st">"MUS"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>                32043rh 32044rh 32046rh 32047rh 32048rh 32049rh
ENSG00000080815   22554       0       0       0   16700       0
ENSG00000142192  344489       4       0       1  260935       6</code></pre>
</div>
<p>Ok, so we see there are two human genes in out count matrix. Why?
What genes are they?</p>
<p>Briefly, 5xFAD mouse strain harbors two human transgenes APP
(“ENSG00000142192”) and PSEN1 (“ENSG00000080815”) and inserted into exon
2 of the mouse Thy1 gene. To validate 5XFAD strain and capture
expression of human transgene APP and PS1, a custom mouse genomic
sequence was created and we quantified expression of human as well as
mouse App (“ENSMUSG00000022892”) and Psen1 (“ENSMUSG00000019969”) genes
by our MODEL-AD RNA-Seq pipeline.</p>
<p><strong>Validation of 5xFAD mouse strain</strong></p>
<p>First we convert the dataframe to longer format and join our
covariates by MouseID</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">count_tpose</span> <span class="op">&lt;-</span> <span class="va">counts</span>  <span class="op">%&gt;%</span></span>
<span>                <span class="fu">rownames_to_column</span><span class="op">(</span><span class="va">.</span>,var<span class="op">=</span><span class="st">"gene_id"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>                <span class="fu">filter</span><span class="op">(</span><span class="va">gene_id</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="st">"ENSG00000080815"</span>,<span class="st">"ENSMUSG00000019969"</span>,<span class="st">"ENSG00000142192"</span>,<span class="st">"ENSMUSG00000022892"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>                <span class="fu">pivot_longer</span><span class="op">(</span><span class="va">.</span>,cols <span class="op">=</span> <span class="op">-</span><span class="st">"gene_id"</span>,names_to <span class="op">=</span> <span class="st">"specimenID"</span>,values_to<span class="op">=</span><span class="st">"counts"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>                <span class="fu">left_join</span><span class="op">(</span><span class="va">covars</span>, by<span class="op">=</span><span class="st">"specimenID"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">count_tpose</span><span class="op">)</span> </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>          gene_id specimenID counts individualID    sex         genotype
1 ENSG00000080815    32043rh  22554        32043 female    5XFAD_carrier
2 ENSG00000080815    32044rh      0        32044   male 5XFAD_noncarrier
3 ENSG00000080815    32046rh      0        32046   male 5XFAD_noncarrier
4 ENSG00000080815    32047rh      0        32047   male 5XFAD_noncarrier
5 ENSG00000080815    32048rh  16700        32048 female    5XFAD_carrier
6 ENSG00000080815    32049rh      0        32049 female 5XFAD_noncarrier
  timepoint
1     12 mo
2     12 mo
3     12 mo
4     12 mo
5     12 mo
6     12 mo</code></pre>
</div>
<p>Rename the APP and PSEN1 genes to specify whether mouse or human.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#make the age column a factor and re-order the levels</span></span>
<span><span class="va">count_tpose</span><span class="op">$</span><span class="va">timepoint</span> <span class="op">&lt;-</span> <span class="fu">factor</span><span class="op">(</span><span class="va">count_tpose</span><span class="op">$</span><span class="va">timepoint</span>,levels<span class="op">=</span><span class="fu">c</span><span class="op">(</span><span class="st">"4 mo"</span>,<span class="st">"6 mo"</span>,<span class="st">"12 mo"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># rename the gene id to gene symbol</span></span>
<span><span class="va">count_tpose</span><span class="op">$</span><span class="va">gene_id</span><span class="op">[</span><span class="va">count_tpose</span><span class="op">$</span><span class="va">gene_id</span> <span class="op">%in%</span> <span class="st">"ENSG00000142192"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Human APP"</span></span>
<span><span class="va">count_tpose</span><span class="op">$</span><span class="va">gene_id</span><span class="op">[</span><span class="va">count_tpose</span><span class="op">$</span><span class="va">gene_id</span> <span class="op">%in%</span> <span class="st">"ENSG00000080815"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Human PSEN1"</span></span>
<span><span class="va">count_tpose</span><span class="op">$</span><span class="va">gene_id</span><span class="op">[</span><span class="va">count_tpose</span><span class="op">$</span><span class="va">gene_id</span> <span class="op">%in%</span> <span class="st">"ENSMUSG00000022892"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Mouse App"</span></span>
<span><span class="va">count_tpose</span><span class="op">$</span><span class="va">gene_id</span><span class="op">[</span><span class="va">count_tpose</span><span class="op">$</span><span class="va">gene_id</span> <span class="op">%in%</span> <span class="st">"ENSMUSG00000019969"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Mouse Psen1"</span></span></code></pre>
</div>
<p>Visualize orthologous genes.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Create simple box plots showing normalized counts by genotype and time point, faceted by sex.</span></span>
<span><span class="va">count_tpose</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">timepoint</span>, y<span class="op">=</span><span class="va">counts</span>, color<span class="op">=</span><span class="va">genotype</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>position<span class="op">=</span><span class="fu">position_jitterdodge</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">sex</span><span class="op">+</span><span class="va">gene_id</span><span class="op">)</span> <span class="op">+</span><span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/differential-expression-analysis-rendered-unnamed-chunk-16-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>You will notice expression of Human APP is higher in 5XFAD carriers
but lower in non-carriers. However mouse App expressed in both 5XFAD
carrier and non-carrier.</p>
<p>We are going to sum the counts from both ortholgous genes (human APP
and mouse App; human PSEN1 and mouse Psen1) and save summed expression
as expression of mouse genes, respectively to match with gene names in
control mice.</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#merge mouse and human APP gene raw count</span></span>
<span><span class="va">counts</span><span class="op">[</span><span class="fu">rownames</span><span class="op">(</span><span class="va">counts</span><span class="op">)</span> <span class="op">%in%</span> <span class="st">"ENSMUSG00000022892"</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">counts</span><span class="op">[</span><span class="fu">rownames</span><span class="op">(</span><span class="va">counts</span><span class="op">)</span> <span class="op">%in%</span> <span class="st">"ENSMUSG00000022892"</span>,<span class="op">]</span> <span class="op">+</span> <span class="va">counts</span><span class="op">[</span><span class="fu">rownames</span><span class="op">(</span><span class="va">counts</span><span class="op">)</span> <span class="op">%in%</span> <span class="st">"ENSG00000142192"</span>,<span class="op">]</span></span>
<span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="va">counts</span><span class="op">[</span><span class="op">!</span><span class="fu">rownames</span><span class="op">(</span><span class="va">counts</span><span class="op">)</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="st">"ENSG00000142192"</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co">#merge mouse and human PS1 gene raw count</span></span>
<span><span class="va">counts</span><span class="op">[</span><span class="fu">rownames</span><span class="op">(</span><span class="va">counts</span><span class="op">)</span> <span class="op">%in%</span> <span class="st">"ENSMUSG00000019969"</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">counts</span><span class="op">[</span><span class="fu">rownames</span><span class="op">(</span><span class="va">counts</span><span class="op">)</span> <span class="op">%in%</span> <span class="st">"ENSMUSG00000019969"</span>,<span class="op">]</span> <span class="op">+</span> <span class="va">counts</span><span class="op">[</span><span class="fu">rownames</span><span class="op">(</span><span class="va">counts</span><span class="op">)</span> <span class="op">%in%</span> <span class="st">"ENSG00000080815"</span>,<span class="op">]</span></span>
<span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="va">counts</span><span class="op">[</span><span class="op">!</span><span class="fu">rownames</span><span class="op">(</span><span class="va">counts</span><span class="op">)</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="st">"ENSG00000080815"</span><span class="op">)</span>,<span class="op">]</span></span></code></pre>
</div>
<p>Let’s verify if expression of both human genes have been merged or
not:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">str_detect</span><span class="op">(</span><span class="fu">rownames</span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="st">"MUS"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 32043rh 32044rh 32046rh 32047rh 32048rh 32049rh
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
<p>What proportion of genes have zero counts in all samples?</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gene_sums</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span>gene_id <span class="op">=</span> <span class="fu">rownames</span><span class="op">(</span><span class="va">counts</span><span class="op">)</span>,</span>
<span>                        sums    <span class="op">=</span> <span class="fu">Matrix</span><span class="fu">::</span><span class="fu">rowSums</span><span class="op">(</span><span class="va">counts</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">sum</span><span class="op">(</span><span class="va">gene_sums</span><span class="op">$</span><span class="va">sums</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 9691</code></pre>
</div>
<p>We can see that 9691 (17%) genes have no reads at all associated with
them. In the next lesson, we will remove genes that have no counts in
any samples.</p>
<div class="section level2">
<h2 id="differential-analysis-using-deseq2">Differential Analysis using DESeq2<a class="anchor" aria-label="anchor" href="#differential-analysis-using-deseq2"></a></h2>
<p>Now, after exploring and formatting the data, We will look for
differential expression between the control and 5xFAD mice at different
ages for both sexes. The differentially expressed genes (DEGs) can
inform our understanding of how the 5XFAD mutation affect the biological
processes.</p>
<p>DESeq2 analysis consist of multiple steps. We are going to briefly
understand some of the important steps using subset of data and then we
will perform differential analysis on whole dataset.</p>
<p>First, order the data (so counts and metadata specimenID orders
match) and save as another variable name</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rawdata</span> <span class="op">&lt;-</span> <span class="va">counts</span><span class="op">[</span>,<span class="fu">sort</span><span class="op">(</span><span class="fu">colnames</span><span class="op">(</span><span class="va">counts</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="va">covars</span><span class="op">[</span><span class="fu">sort</span><span class="op">(</span><span class="fu">rownames</span><span class="op">(</span><span class="va">covars</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span></code></pre>
</div>
<p>subset the counts matrix and sample metadata to include only 12 month
old male mice. You can amend the code to compare wild type and 5XFAD
mice from either sex, at any time point.</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta.12M.Male</span> <span class="op">&lt;-</span> <span class="va">metadata</span><span class="op">[</span><span class="op">(</span><span class="va">metadata</span><span class="op">$</span><span class="va">sex</span><span class="op">==</span><span class="st">"male"</span> <span class="op">&amp;</span> <span class="va">metadata</span><span class="op">$</span><span class="va">timepoint</span><span class="op">==</span><span class="st">'12 mo'</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">meta.12M.Male</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>        individualID specimenID  sex         genotype timepoint
32044rh        32044    32044rh male 5XFAD_noncarrier     12 mo
32046rh        32046    32046rh male 5XFAD_noncarrier     12 mo
32047rh        32047    32047rh male 5XFAD_noncarrier     12 mo
32053rh        32053    32053rh male    5XFAD_carrier     12 mo
32059rh        32059    32059rh male    5XFAD_carrier     12 mo
32061rh        32061    32061rh male 5XFAD_noncarrier     12 mo
32062rh        32062    32062rh male    5XFAD_carrier     12 mo
32073rh        32073    32073rh male 5XFAD_noncarrier     12 mo
32074rh        32074    32074rh male 5XFAD_noncarrier     12 mo
32075rh        32075    32075rh male    5XFAD_carrier     12 mo
32088rh        32088    32088rh male    5XFAD_carrier     12 mo
32640rh        32640    32640rh male    5XFAD_carrier     12 mo</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">as.matrix</span><span class="op">(</span><span class="va">rawdata</span><span class="op">[</span>,<span class="fu">colnames</span><span class="op">(</span><span class="va">rawdata</span><span class="op">)</span> <span class="op">%in%</span> <span class="fu">rownames</span><span class="op">(</span><span class="va">meta.12M.Male</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu">colnames</span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "32044rh" "32046rh" "32047rh" "32053rh" "32059rh" "32061rh" "32062rh"
 [8] "32073rh" "32074rh" "32075rh" "32088rh" "32640rh"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rownames</span><span class="op">(</span><span class="va">meta.12M.Male</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "32044rh" "32046rh" "32047rh" "32053rh" "32059rh" "32061rh" "32062rh"
 [8] "32073rh" "32074rh" "32075rh" "32088rh" "32640rh"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">match</span><span class="op">(</span><span class="fu">colnames</span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>,<span class="fu">rownames</span><span class="op">(</span><span class="va">meta.12M.Male</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1]  1  2  3  4  5  6  7  8  9 10 11 12</code></pre>
</div>
<p>Next, we build the DESeqDataSet using the following function:</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ddsHTSeq</span> <span class="op">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span><span class="op">(</span>countData<span class="op">=</span><span class="va">dat</span>, </span>
<span>                                   colData<span class="op">=</span><span class="va">meta.12M.Male</span>, </span>
<span>                                   design <span class="op">=</span> <span class="op">~</span><span class="va">genotype</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ddsHTSeq</span></span></code></pre>
</div>
<p><strong>Pre-filtering</strong></p>
<p>While it is not necessary to pre-filter low count genes before
running the DESeq2 functions, there are two reasons which make
pre-filtering useful: by removing rows in which there are very few
reads, we reduce the memory size of the dds data object, and we increase
the speed of the transformation and testing functions within DESeq2. It
can also improve visualizations, as features with no information for
differential expression are not plotted.</p>
<p>Here we perform a minimal pre-filtering to keep only rows that have
at least 10 reads total.</p>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ddsHTSeq</span> <span class="op">&lt;-</span> <span class="va">ddsHTSeq</span><span class="op">[</span><span class="fu">rowSums</span><span class="op">(</span><span class="fu">counts</span><span class="op">(</span><span class="va">ddsHTSeq</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">10</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">ddsHTSeq</span></span></code></pre>
</div>
<p><strong>Reference level</strong></p>
<p>By default, R will choose a reference level for factors based on
alphabetical order. Then, if you never tell the DESeq2 functions which
level you want to compare against (e.g. which level represents the
control group), the comparisons will be based on the alphabetical order
of the levels.</p>
<p>specifying the reference-level to 5XFAD_noncarrier:</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ddsHTSeq</span><span class="op">$</span><span class="va">genotype</span> <span class="op">&lt;-</span> <span class="fu">relevel</span><span class="op">(</span><span class="va">ddsHTSeq</span><span class="op">$</span><span class="va">genotype</span>,ref<span class="op">=</span><span class="st">"5XFAD_noncarrier"</span><span class="op">)</span>  </span></code></pre>
</div>
<p>Run the standard differential expression analysis steps that is
wrapped into a single function, DESeq.</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dds</span> <span class="op">&lt;-</span> <span class="fu">DESeq</span><span class="op">(</span><span class="va">ddsHTSeq</span>,parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>Results tables are generated using the function results, which
extracts a results table with log2 fold changes, p values and adjusted p
values. By default the argument alpha is set to 0.1. If the adjusted p
value cutoff will be a value other than 0.1, alpha should be set to that
value:</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">results</span><span class="op">(</span><span class="va">dds</span>,alpha<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span>  <span class="co"># setting 0.05 as significant threshold</span></span>
<span><span class="va">res</span></span></code></pre>
</div>
<p>We can order our results table by the smallest p value:</p>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resOrdered</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">[</span><span class="fu">order</span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">pvalue</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">resOrdered</span>,n<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
<p>we can summarize some basic tallies using the summary function.</p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></code></pre>
</div>
<p>How many adjusted p-values were less than 0.05?</p>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sum</span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">padj</span> <span class="op">&lt;</span> <span class="fl">0.05</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>How many adjusted p-values were less than 0.1?</p>
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sum</span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">padj</span> <span class="op">&lt;</span> <span class="fl">0.1</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p><strong>Function to convert ensembleIDs to common gene
names</strong></p>
<p>We’ll use a package to translate mouse ENSEMBL IDS to gene names. Run
this function and they will be called up when assembling results from
the differential expression analysis</p>
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map_function.df</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">inputtype</span>, <span class="va">outputtype</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">mapIds</span><span class="op">(</span></span>
<span>    <span class="va">org.Mm.eg.db</span>,</span>
<span>    keys <span class="op">=</span> <span class="fu">row.names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    column <span class="op">=</span> <span class="va">outputtype</span>,</span>
<span>    keytype <span class="op">=</span> <span class="va">inputtype</span>,</span>
<span>    multiVals <span class="op">=</span> <span class="st">"first"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p><strong>Generating Results table</strong></p>
<p>Here we will call the function to get the ‘symbol’ names of the genes
incorporated into the results table, along with the columns we are most
interested in</p>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">All_res</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>symbol <span class="op">=</span> <span class="fu">map_function.df</span><span class="op">(</span><span class="va">res</span>,<span class="st">"ENSEMBL"</span>,<span class="st">"SYMBOL"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>    <span class="co">##run map_function to add symbol of gene corresponding to ENSEBL ID</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>EntrezGene <span class="op">=</span> <span class="fu">map_function.df</span><span class="op">(</span><span class="va">res</span>,<span class="st">"ENSEMBL"</span>,<span class="st">"ENTREZID"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co">##run map_function to add Entrez ID of gene corresponding to ENSEBL ID</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">select</span><span class="op">(</span><span class="st">"symbol"</span>, <span class="st">"EntrezGene"</span>,<span class="st">"baseMean"</span>, <span class="st">"log2FoldChange"</span>, <span class="st">"lfcSE"</span>, <span class="st">"stat"</span>, <span class="st">"pvalue"</span>, <span class="st">"padj"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">All_res</span><span class="op">)</span></span></code></pre>
</div>
<p><strong>Extracting genes that are significantly
expressed</strong></p>
<p>Let’s subset all the genes with a pvalue &lt; 0.05</p>
<div class="codewrapper sourceCode" id="cb52">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dseq_res</span> <span class="op">&lt;-</span> <span class="fu">subset</span><span class="op">(</span><span class="va">All_res</span><span class="op">[</span><span class="fu">order</span><span class="op">(</span><span class="va">All_res</span><span class="op">$</span><span class="va">padj</span><span class="op">)</span>, <span class="op">]</span>, <span class="va">padj</span> <span class="op">&lt;</span> <span class="fl">0.05</span><span class="op">)</span></span></code></pre>
</div>
<p>Wow! We have a lot of genes with apparently very strong statistically
significant differences between the control and 5xFAD carrier.</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dim</span><span class="op">(</span><span class="va">dseq_res</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb54">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">dseq_res</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="exploring-and-exporting-results">Exploring and exporting results<a class="anchor" aria-label="anchor" href="#exploring-and-exporting-results"></a></h2>
<p><strong>Exporting results to CSV files</strong></p>
<p>we can save results file into a csv file like this:</p>
<div class="codewrapper sourceCode" id="cb55">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">write.csv</span><span class="op">(</span><span class="va">All_res</span>,file<span class="op">=</span><span class="st">"results/All_5xFAD_12months_male.csv"</span><span class="op">)</span></span>
<span><span class="fu">write.csv</span><span class="op">(</span><span class="va">dseq_res</span>,file<span class="op">=</span><span class="st">"results/DEG_5xFAD_12months_male.csv"</span><span class="op">)</span></span></code></pre>
</div>
<p><strong>Volcano plot</strong></p>
<p>We can visualize the differential expression results using Volcano
plot function from EnhancedVolcano package. For the most basic volcano
plot, only a single data-frame, data-matrix, or tibble of test results
is required, containing point labels, log2FC, and adjusted or unadjusted
P values. The default cut-off for log2FC is &gt;|2|; the default cut-off
for P value is 10e-6.</p>
<div class="codewrapper sourceCode" id="cb56">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">EnhancedVolcano</span><span class="op">(</span><span class="va">All_res</span>,</span>
<span>                                   lab <span class="op">=</span> <span class="op">(</span><span class="va">All_res</span><span class="op">$</span><span class="va">symbol</span><span class="op">)</span>,</span>
<span>                                   x <span class="op">=</span> <span class="st">'log2FoldChange'</span>,</span>
<span>                                   y <span class="op">=</span> <span class="st">'padj'</span>,legendPosition <span class="op">=</span> <span class="st">'none'</span>,</span>
<span>                                   title <span class="op">=</span> <span class="st">'Volcano plot:Differential Expression Results'</span>,</span>
<span>                                   subtitle <span class="op">=</span> <span class="st">''</span>,</span>
<span>                                   FCcutoff <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                                   pCutoff <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                                   xlim <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>You can see that some top significantly expressed are
immune/inflammation-related genes such as Ctsd, C4b, Csf1 etc. These
genes are upregulated in the 5XFAD strain.</p>
<p><strong>Principal component plot of the samples</strong></p>
<p>Principal component analysis is a dimension reduction technique that
reduces the dimensionality of these large matrixes into a linear
coordinate system, so that we can more easily visualize what factors are
contributing the most to variation in the dataset by graphing the
principal components.</p>
<div class="codewrapper sourceCode" id="cb57">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ddsHTSeq</span> <span class="op">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span><span class="op">(</span>countData<span class="op">=</span><span class="fu">as.matrix</span><span class="op">(</span><span class="va">rawdata</span><span class="op">)</span>, colData<span class="op">=</span><span class="va">metadata</span>, design<span class="op">=</span> <span class="op">~</span> <span class="va">genotype</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb58">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ddsHTSeq</span> <span class="op">&lt;-</span> <span class="va">ddsHTSeq</span><span class="op">[</span><span class="fu">rowSums</span><span class="op">(</span><span class="fu">counts</span><span class="op">(</span><span class="va">ddsHTSeq</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">10</span>, <span class="op">]</span></span>
<span><span class="va">dds</span> <span class="op">&lt;-</span> <span class="fu">DESeq</span><span class="op">(</span><span class="va">ddsHTSeq</span>,parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb59">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vsd</span> <span class="op">&lt;-</span> <span class="fu">varianceStabilizingTransformation</span><span class="op">(</span><span class="va">dds</span>, blind<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plotPCA</span><span class="op">(</span><span class="va">vsd</span>, intgroup<span class="op">=</span><span class="fu">c</span><span class="op">(</span><span class="st">"genotype"</span>, <span class="st">"sex"</span>,<span class="st">"timepoint"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>We can see that clustering is occurring, though it’s kind of hard to
see exactly how they are clustering in this visualization.</p>
<p>It is also possible to customize the PCA plot using the ggplot
function.</p>
<div class="codewrapper sourceCode" id="cb60">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pcaData</span> <span class="op">&lt;-</span> <span class="fu">plotPCA</span><span class="op">(</span><span class="va">vsd</span>, intgroup<span class="op">=</span><span class="fu">c</span><span class="op">(</span><span class="st">"genotype"</span>, <span class="st">"sex"</span>,<span class="st">"timepoint"</span><span class="op">)</span>, returnData<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">percentVar</span> <span class="op">&lt;-</span> <span class="fu">round</span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="fu">attr</span><span class="op">(</span><span class="va">pcaData</span>, <span class="st">"percentVar"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">pcaData</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">PC1</span>, <span class="va">PC2</span>,color<span class="op">=</span><span class="va">genotype</span>, shape<span class="op">=</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label<span class="op">=</span><span class="va">timepoint</span><span class="op">)</span>,hjust<span class="op">=</span><span class="fl">0.5</span>, vjust<span class="op">=</span><span class="fl">2</span>,size <span class="op">=</span><span class="fl">3.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span> <span class="fu">paste0</span><span class="op">(</span><span class="st">"PC1: "</span>,<span class="va">percentVar</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="st">"% variance"</span><span class="op">)</span>, y<span class="op">=</span> <span class="fu">paste0</span><span class="op">(</span><span class="st">"PC2: "</span>,<span class="va">percentVar</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,<span class="st">"% variance"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>PCA identified genotype and sex being a major source of variation in
between 5XFAD and WT mice. Female and male samples from the 5XFAD
carriers clustered distinctly at all ages, suggesting the presence of
sex-biased molecular changes in animals.</p>
<p><strong>Function for Differential analysis using DESeq2</strong></p>
<p>Finally, we can build a function for differential analysis that
consists of all above discussed steps. It will require to input sorted
raw count matrix, sample metadata and define the reference group.</p>
<div class="codewrapper sourceCode" id="cb61">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DEG</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rawdata</span>, <span class="va">meta</span>,</span>
<span>                   <span class="va">include.batch</span> <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                   <span class="va">ref</span> <span class="op">=</span> <span class="va">ref</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dseq_res</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">All_res</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">include.batch</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">cat</span><span class="op">(</span><span class="st">"Including batch as covariate\n"</span><span class="op">)</span></span>
<span>    <span class="va">design_formula</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="va">Batch</span> <span class="op">+</span> <span class="va">genotype</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">else</span><span class="op">{</span></span>
<span>    <span class="va">design_formula</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="va">genotype</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">dat2</span> <span class="op">&lt;-</span> <span class="fu">as.matrix</span><span class="op">(</span><span class="va">rawdata</span><span class="op">[</span>, <span class="fu">colnames</span><span class="op">(</span><span class="va">rawdata</span><span class="op">)</span> <span class="op">%in%</span> <span class="fu">rownames</span><span class="op">(</span><span class="va">meta</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">ddsHTSeq</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">DESeqDataSetFromMatrix</span><span class="op">(</span>countData <span class="op">=</span> <span class="va">dat2</span>,</span>
<span>                           colData <span class="op">=</span> <span class="va">meta</span>,</span>
<span>                           design <span class="op">=</span> <span class="va">design_formula</span><span class="op">)</span></span>
<span>  <span class="va">ddsHTSeq</span> <span class="op">&lt;-</span> <span class="va">ddsHTSeq</span><span class="op">[</span><span class="fu">rowSums</span><span class="op">(</span><span class="fu">counts</span><span class="op">(</span><span class="va">ddsHTSeq</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">10</span>, <span class="op">]</span></span>
<span>  <span class="va">ddsHTSeq</span><span class="op">$</span><span class="va">genotype</span> <span class="op">&lt;-</span> <span class="fu">relevel</span><span class="op">(</span><span class="va">ddsHTSeq</span><span class="op">$</span><span class="va">genotype</span>, ref <span class="op">=</span> <span class="va">ref</span><span class="op">)</span></span>
<span>  <span class="va">dds</span> <span class="op">&lt;-</span> <span class="fu">DESeq</span><span class="op">(</span><span class="va">ddsHTSeq</span>, parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">results</span><span class="op">(</span><span class="va">dds</span>, alpha <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span>  <span class="co">#summary(res)</span></span>
<span>  </span>
<span>  <span class="va">res</span><span class="op">$</span><span class="va">symbol</span> <span class="op">&lt;-</span> <span class="fu">map_function.df</span><span class="op">(</span><span class="va">res</span>,<span class="st">"ENSEMBL"</span>,<span class="st">"SYMBOL"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">res</span><span class="op">$</span><span class="va">EntrezGene</span> <span class="op">&lt;-</span> <span class="fu">map_function.df</span><span class="op">(</span><span class="va">res</span>,<span class="st">"ENSEMBL"</span>,<span class="st">"ENTREZID"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">All_res</span> <span class="op">&lt;&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">res</span><span class="op">[</span>, <span class="fu">c</span><span class="op">(</span><span class="st">"symbol"</span>, <span class="st">"EntrezGene"</span>,<span class="st">"baseMean"</span>, <span class="st">"log2FoldChange"</span>, <span class="st">"lfcSE"</span>, <span class="st">"stat"</span>, <span class="st">"pvalue"</span>, <span class="st">"padj"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>Let’s use this function to analyze all groups present in our
data.</p>
<p><strong>Differential Analysis of all groups</strong></p>
<p>First, we add a Group column to our metadata table that will combine
all variables of interest (genotype, sex, and timepoint) for each
sample.</p>
<div class="codewrapper sourceCode" id="cb62">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata</span><span class="op">$</span><span class="va">Group</span> <span class="op">&lt;-</span> <span class="fu">paste0</span><span class="op">(</span><span class="va">metadata</span><span class="op">$</span><span class="va">genotype</span>,<span class="st">"-"</span>,<span class="va">metadata</span><span class="op">$</span><span class="va">sex</span>,<span class="st">"-"</span>,<span class="va">metadata</span><span class="op">$</span><span class="va">timepoint</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">unique</span><span class="op">(</span><span class="va">metadata</span><span class="op">$</span><span class="va">Group</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "5XFAD_carrier-female-12 mo"    "5XFAD_noncarrier-male-12 mo"
 [3] "5XFAD_noncarrier-female-12 mo" "5XFAD_carrier-male-12 mo"
 [5] "5XFAD_noncarrier-female-6 mo"  "5XFAD_noncarrier-male-6 mo"
 [7] "5XFAD_carrier-female-6 mo"     "5XFAD_noncarrier-female-4 mo"
 [9] "5XFAD_carrier-female-4 mo"     "5XFAD_carrier-male-6 mo"
[11] "5XFAD_carrier-male-4 mo"       "5XFAD_noncarrier-male-4 mo"   </code></pre>
</div>
<p>Next, we create a comparison table that has all cases and controls
that we would like to compare with each other. Here I have made
comparison groups for age and sex-matched 5xFAD carriers vs
5xFAD_noncarriers, with carriers as the cases and noncarriers as the
controls:</p>
<div class="codewrapper sourceCode" id="cb64">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">comparisons</span> <span class="op">&lt;-</span>  <span class="fu">data.frame</span><span class="op">(</span>control<span class="op">=</span><span class="fu">c</span><span class="op">(</span><span class="st">"5XFAD_noncarrier-male-4 mo"</span>, <span class="st">"5XFAD_noncarrier-female-4 mo"</span>, <span class="st">"5XFAD_noncarrier-male-6 mo"</span>, </span>
<span>                                     <span class="st">"5XFAD_noncarrier-female-6 mo"</span>,<span class="st">"5XFAD_noncarrier-male-12 mo"</span>, <span class="st">"5XFAD_noncarrier-female-12 mo"</span><span class="op">)</span>, </span>
<span>                           case<span class="op">=</span><span class="fu">c</span><span class="op">(</span><span class="st">"5XFAD_carrier-male-4 mo"</span>, <span class="st">"5XFAD_carrier-female-4 mo"</span>, <span class="st">"5XFAD_carrier-male-6 mo"</span>, </span>
<span>                                  <span class="st">"5XFAD_carrier-female-6 mo"</span>,<span class="st">"5XFAD_carrier-male-12 mo"</span>, <span class="st">"5XFAD_carrier-female-12 mo"</span><span class="op">)</span></span>
<span>                           <span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb65">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">comparisons</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>                        control                       case
1    5XFAD_noncarrier-male-4 mo    5XFAD_carrier-male-4 mo
2  5XFAD_noncarrier-female-4 mo  5XFAD_carrier-female-4 mo
3    5XFAD_noncarrier-male-6 mo    5XFAD_carrier-male-6 mo
4  5XFAD_noncarrier-female-6 mo  5XFAD_carrier-female-6 mo
5   5XFAD_noncarrier-male-12 mo   5XFAD_carrier-male-12 mo
6 5XFAD_noncarrier-female-12 mo 5XFAD_carrier-female-12 mo</code></pre>
</div>
<p>Finally, we implement our DEG function on each case/control
comparison of interest and store the result table in a list and data
frame:</p>
<div class="codewrapper sourceCode" id="cb67">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># initiate an empty list and data frame to save results</span></span>
<span><span class="va">DE_5xFAD.list</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">DE_5xFAD.df</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu">nrow</span><span class="op">(</span><span class="va">comparisons</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="va">meta</span> <span class="op">&lt;-</span> <span class="va">metadata</span><span class="op">[</span><span class="va">metadata</span><span class="op">$</span><span class="va">Group</span> <span class="op">%in%</span> <span class="va">comparisons</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span>,<span class="op">]</span></span>
<span>    <span class="fu">DEG</span><span class="op">(</span><span class="va">rawdata</span>,<span class="va">meta</span>,ref <span class="op">=</span> <span class="st">"5XFAD_noncarrier"</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co">#append results in data frame</span></span>
<span>    <span class="va">DE_5xFAD.df</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span><span class="va">DE_5xFAD.df</span>,<span class="va">All_res</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>model<span class="op">=</span><span class="st">"5xFAD"</span>,sex<span class="op">=</span><span class="fu">unique</span><span class="op">(</span><span class="va">meta</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span>,age<span class="op">=</span><span class="fu">unique</span><span class="op">(</span><span class="va">meta</span><span class="op">$</span><span class="va">timepoint</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co">#append results in list</span></span>
<span>    <span class="va">DE_5xFAD.list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">All_res</span></span>
<span>    <span class="fu">names</span><span class="op">(</span><span class="va">DE_5xFAD.list</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">paste0</span><span class="op">(</span><span class="va">comparisons</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>Let’s explore the result stored in our list:</p>
<div class="codewrapper sourceCode" id="cb68">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">DE_5xFAD.list</span><span class="op">)</span></span></code></pre>
</div>
<p>We can easily extract the result table for any group of interest by
using $ and name of group. Let’s check top few rows from
5XFAD_carrier-male-4 mo group:</p>
<div class="codewrapper sourceCode" id="cb69">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">DE_5xFAD.list</span><span class="op">$</span><span class="va">`5XFAD_carrier-male-4 mo`</span><span class="op">)</span></span></code></pre>
</div>
<p>Let’s check the result stored as dataframe:</p>
<div class="codewrapper sourceCode" id="cb70">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">DE_5xFAD.df</span><span class="op">)</span></span></code></pre>
</div>
<p>Check if result is present for all ages:</p>
<div class="codewrapper sourceCode" id="cb71">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">unique</span><span class="op">(</span><span class="op">(</span><span class="va">DE_5xFAD.df</span><span class="op">$</span><span class="va">age</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Check if result is present for both sexes:</p>
<div class="codewrapper sourceCode" id="cb72">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">unique</span><span class="op">(</span><span class="op">(</span><span class="va">DE_5xFAD.df</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Check number of genes in each group:</p>
<div class="codewrapper sourceCode" id="cb73">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu">count</span><span class="op">(</span><span class="va">DE_5xFAD.df</span>,<span class="va">model</span>,<span class="va">sex</span>,<span class="va">age</span><span class="op">)</span></span></code></pre>
</div>
<p>Check number of genes significantly differentially expressed in all
cases compared to age and sex-matched controls:</p>
<div class="codewrapper sourceCode" id="cb74">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">degs.up</span> <span class="op">&lt;-</span> <span class="fu">map</span><span class="op">(</span><span class="va">DE_5xFAD.list</span>, <span class="op">~</span><span class="fu">length</span><span class="op">(</span><span class="fu">which</span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">padj</span><span class="op">&lt;</span><span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">.x</span><span class="op">$</span><span class="va">log2FoldChange</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">degs.down</span> <span class="op">&lt;-</span> <span class="fu">map</span><span class="op">(</span><span class="va">DE_5xFAD.list</span>, <span class="op">~</span><span class="fu">length</span><span class="op">(</span><span class="fu">which</span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">padj</span><span class="op">&lt;</span><span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">.x</span><span class="op">$</span><span class="va">log2FoldChange</span><span class="op">&lt;</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">deg</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span>Cases<span class="op">=</span><span class="fu">names</span><span class="op">(</span><span class="va">degs.up</span><span class="op">)</span>, Up_DEGs.pval.05<span class="op">=</span><span class="fu">as.vector</span><span class="op">(</span><span class="fu">unlist</span><span class="op">(</span><span class="va">degs.up</span><span class="op">)</span><span class="op">)</span>,Down_DEGs.pval.05<span class="op">=</span><span class="fu">as.vector</span><span class="op">(</span><span class="fu">unlist</span><span class="op">(</span><span class="va">degs.down</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu">kable</span><span class="op">(</span><span class="va">deg</span><span class="op">)</span></span></code></pre>
</div>
<p>Interestingly, in females more genes are differentially expressed at
all age groups, and more genes are differentially expressed the older
the mice get in both sexes.</p>
</div>
<div class="section level2">
<h2 id="pathway-enrichment">Pathway Enrichment<a class="anchor" aria-label="anchor" href="#pathway-enrichment"></a></h2>
<p>We may wish to look for enrichment of biological pathways in a list
of differentially expressed genes. Here we will test for enrichment of
KEGG pathways using using enrichKEGG function in clusterProfiler
package.</p>
<div class="codewrapper sourceCode" id="cb75">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span>FAD_M_4<span class="op">=</span><span class="fu">subset</span><span class="op">(</span><span class="va">DE_5xFAD.list</span><span class="op">$</span><span class="va">`5XFAD_carrier-male-4 mo`</span><span class="op">[</span><span class="fu">order</span><span class="op">(</span><span class="va">DE_5xFAD.list</span><span class="op">$</span><span class="va">`5XFAD_carrier-male-4 mo`</span><span class="op">$</span><span class="va">padj</span><span class="op">)</span>, <span class="op">]</span>, <span class="va">padj</span> <span class="op">&lt;</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">EntrezGene</span><span class="op">)</span>,</span>
<span>            FAD_F_4<span class="op">=</span><span class="fu">subset</span><span class="op">(</span><span class="va">DE_5xFAD.list</span><span class="op">$</span><span class="va">`5XFAD_carrier-female-4 mo`</span><span class="op">[</span><span class="fu">order</span><span class="op">(</span><span class="va">DE_5xFAD.list</span><span class="op">$</span><span class="va">`5XFAD_carrier-female-4 mo`</span><span class="op">$</span><span class="va">padj</span><span class="op">)</span>, <span class="op">]</span>, <span class="va">padj</span> <span class="op">&lt;</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">EntrezGene</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## perform enrichment analysis</span></span>
<span><span class="va">enrich_pathway</span> <span class="op">&lt;-</span> <span class="fu">compareCluster</span><span class="op">(</span><span class="va">dat</span>,</span>
<span>                                 fun <span class="op">=</span> <span class="st">"enrichKEGG"</span>,</span>
<span>                                  pvalueCutoff <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                                  organism <span class="op">=</span> <span class="st">"mmu"</span></span>
<span>                                 <span class="op">)</span></span>
<span></span>
<span><span class="va">enrich_pathway</span><span class="op">@</span><span class="va">compareClusterResult</span><span class="op">$</span><span class="va">Description</span> <span class="op">&lt;-</span> <span class="fu">gsub</span><span class="op">(</span><span class="st">" - Mus musculus \\(house mouse)"</span>,<span class="st">""</span>,<span class="va">enrich_pathway</span><span class="op">@</span><span class="va">compareClusterResult</span><span class="op">$</span><span class="va">Description</span><span class="op">)</span></span></code></pre>
</div>
<p>Let’s plot top enriched functions using dotplot function of
clusterProfiler package.</p>
<div class="codewrapper sourceCode" id="cb76">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">clusterProfiler</span><span class="fu">::</span><span class="fu">dotplot</span><span class="op">(</span><span class="va">enrich_pathway</span>,showCategory<span class="op">=</span><span class="fl">10</span>,font.size <span class="op">=</span> <span class="fl">14</span>,title<span class="op">=</span><span class="st">"Enriched KEGG Pathways"</span><span class="op">)</span></span></code></pre>
</div>
<p>What does this plot infer?</p>
</div>
<div class="section level2">
<h2 id="save-data-for-next-lesson">Save Data for Next Lesson<a class="anchor" aria-label="anchor" href="#save-data-for-next-lesson"></a></h2>
<p>We will use the results data in the next lesson. Save it now and we
will load it at the beginning of the next lesson. We will use R’s save
command to save the objects in compressed, binary format. The save
command is useful when you want to save multiple objects in one
file.</p>
<div class="codewrapper sourceCode" id="cb77">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">save</span><span class="op">(</span><span class="va">DE_5xFAD.df</span>,<span class="va">DE_5xFAD.list</span>,file<span class="op">=</span><span class="st">"results/DEAnalysis_5XFAD.Rdata"</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a></h2>
<div class="codewrapper sourceCode" id="cb78">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sessionInfo</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>R version 4.4.1 (2024-06-14)
Platform: x86_64-pc-linux-gnu
Running under: Ubuntu 22.04.4 LTS

Matrix products: default
BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.10.0
LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.10.0

locale:
 [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8
 [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8
 [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C
[10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C

time zone: UTC
tzcode source: system (glibc)

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
 [1] lubridate_1.9.3 forcats_1.0.0   stringr_1.5.1   dplyr_1.1.4
 [5] purrr_1.0.2     readr_2.1.5     tidyr_1.3.1     tibble_3.2.1
 [9] ggplot2_3.5.1   tidyverse_2.0.0

loaded via a namespace (and not attached):
 [1] Matrix_1.6-5     gtable_0.3.5     compiler_4.4.1   renv_1.0.7
 [5] highr_0.11       tidyselect_1.2.1 scales_1.3.0     yaml_2.3.10
 [9] lattice_0.22-5   R6_2.5.1         labeling_0.4.3   generics_0.1.3
[13] knitr_1.48       munsell_0.5.1    pillar_1.9.0     tzdb_0.4.0
[17] rlang_1.1.4      utf8_1.2.4       stringi_1.8.4    xfun_0.46
[21] timechange_0.3.0 cli_3.6.3        withr_3.0.0      magrittr_2.0.3
[25] grid_4.4.1       hms_1.1.3        lifecycle_1.0.4  vctrs_0.6.5
[29] evaluate_0.24.0  glue_1.7.0       farver_2.1.2     fansi_1.0.6
[33] colorspace_2.1-1 tools_4.4.1      pkgconfig_2.0.3 </code></pre>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</div>



      </div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="exploring-data-in-synapse.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="mouse-human-alignment.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="exploring-data-in-synapse.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Synapse and AD
        </a>
        <a class="chapter-link float-end" href="mouse-human-alignment.html" rel="next">
          Next: Mouse-human...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/carpentries/workbench-template-md/edit/main/episodes/differential-expression-analysis.Rmd" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/carpentries/workbench-template-md/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/carpentries/workbench-template-md/" class="external-link">Source</a></p>
				<p><a href="https://github.com/carpentries/workbench-template-md/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.5" class="external-link">sandpaper (0.16.5)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.6" class="external-link">pegboard (0.7.6)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.3" class="external-link">varnish (1.0.3)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://carpentries.github.io/workbench-template-md/differential-expression-analysis.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "Alzheimers, data, lesson, MODEL-AD",
  "name": "Differential expression analysis",
  "creativeWorkStatus": "active",
  "url": "https://carpentries.github.io/workbench-template-md/differential-expression-analysis.html",
  "identifier": "https://carpentries.github.io/workbench-template-md/differential-expression-analysis.html",
  "dateCreated": "2024-07-24",
  "dateModified": "2024-07-30",
  "datePublished": "2024-07-30"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

